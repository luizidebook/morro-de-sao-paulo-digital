<!DOCTYPE html>
<html lang="pt">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#3b82f6" />
    <meta name="msapplication-navbutton-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-status-bar-style" content="#3b82f6">
    <meta
      name="description"
      content="Guia digital interativo de Morro de São Paulo"
    />
    <title>Morro de São Paulo Digital</title>
    <link rel="stylesheet" href="./css/main.css" />
    <link rel="stylesheet" href="./css/components/accessibility.css" />
    <link rel="stylesheet" href="./css/vendor-fixes.css" />
    <link rel="stylesheet" href="css/components/map/mapbox-osm-3d.css">
  
<!-- Carregar Leaflet primeiro (versão única) -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<!-- Carregar apenas uma versão do Leaflet -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<!-- Adicionar plugins necessários para rotação -->
<script src="./js/plugins/leaflet.rotatedMarker.js"></script>
<script src="./js/plugins/leaflet.mapbearing.js"></script>
<!-- Carregar o plugin polylineDecorator apenas uma vez -->
<script src="./js/lib/leaflet.polylineDecorator.js"></script>

<link
rel="stylesheet"
href="https://unpkg.com/swiper/swiper-bundle.min.css"
/>
<script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>

<link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.5/awesomplete.min.css"
    />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.5/awesomplete.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/weather-icons/2.0.10/css/weather-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      #loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #0043b3;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        transition: opacity 0.5s ease-in-out;
      }
      
      #loading-overlay.fade-out {
        opacity: 0;
        pointer-events: none;
      }
      
      .loading-spinner {
        width: 50px;
        height: 50px;
        border: 5px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: #fff;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
      }
      
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
      
      .loading-text {
        color: white;
        font-size: 18px;
        font-family: 'Poppins', sans-serif;
        text-align: center;
        max-width: 80%;
      }
    </style>
</head>

  <body>
    <!-- App Shell -->
    <div class="app-shell">
      <!-- Cabeçalho -->
      <header>
        <div class="header-content">
          <h1 data-i18n="welcome_message">Morro Digital</h1>
          <p class="tagline" data-i18n="ask_first_time">Descubra o paraíso</p>
        </div>
      </header>

      <!-- Mapa -->
        <div id="map-container">
          <div id="map"></div>
          <!-- O widget será inserido aqui -->
        </div>
      </section>

      <!-- Submenu dinâmico -->
      <section id="submenu" class="hidden">
        <div class="submenu-header">
          <h3 class="submenu-title">Explorar Locais</h3>
          <button class="close-button" aria-label="Fechar menu">×</button>
        </div>
        <div id="submenuContainer" aria-live="polite"></div>
      </section>

<!-- Quick Action Buttons -->
<div class="quick-actions">
  <button class="action-button primary mood-button" data-mood="happy">
    <img class="mood-icon" src="./assets/emojis/sun_emojis/sun_emoji_1.png" alt="Humor do assistente">
  </button>
</div>

      <!-- Assistente Virtual -->            
      <div id="assistant-messages" class="assistant-modal hidden">
        <button class="minimize-button" aria-label="Minimizar assistente">×</button>
        <div class="messages-area"></div>
    <!-- Quando em modo normal -->
    <div class="message assistant" data-message-type="standard"></div>
    <!-- Quando em modo de navegação -->

      <!-- Carrossel sem espaços desnecessários -->
  <div class="carousel-container">
    <div class="swiper-container">
      <!-- Conteúdo do swiper -->
    </div>
    <div class="carousel-info-text">Primeira Praia</div>
  </div>
  
  <!-- Mensagem de seguimento compacta, sem espaços extras -->
  <div class="message assistant carousel-follow-up">
    Gostaria de mais informações, como chegar ou ver outro local?
  </div>
  <!-- Mensagem de navegação, com espaço para instruções -->
  <div class="navigation-instruction-area"></div></div>      
<!-- Campo de input do assistente, fora do balão -->
<div id="assistant-input-area" class="assistant-input-area">
  <input
    type="text"
    id="assistantInput"
    placeholder="Pergunte algo sobre Morro de São Paulo..."
    aria-label="Campo de entrada do assistente"
  />
  <button id="sendButton" aria-label="Enviar mensagem">
    <i class="fas fa-paper-plane"></i>
  </button>
  <button id="voiceButton" aria-label="Enviar mensagem de voz">
    <i class="fas fa-microphone"></i>
  </button>
  <button id="configButton" aria-label="Configurações do assistente">
    <i class="fas fa-cog"></i>
  </button>
</div>
       
<div id="loading-overlay">
  <div class="loading-spinner"></div>
  <p class="loading-text">Carregando Morro Digital...</p>
</div>

<script>
  // Expose function to hide overlay
  window.hideLoadingOverlay = function() {
    const overlay = document.getElementById("loading-overlay");
    if (overlay) {
      overlay.classList.add("fade-out");
      
      // After animation completes, hide completely
      setTimeout(() => {
        overlay.style.display = 'none';
      }, 600); // slightly longer than the CSS transition
    }
  };
</script>

<!-- Após os scripts do Leaflet -->
<script>
  // Token do Mapbox (mantenha seguro em produção)
  window.mapboxToken = 'pk.eyJ1IjoibW9ycm9kaWdpdGFsIiwiYSI6ImNscWEzaHVnNzAwbjIyanBmeGE1bXY0aTYifQ.3f3nf3e8QnHRH7whYn5ljg';

  // Garantir que o mapboxgl esteja disponível globalmente
  window.initMapboxGL = function() {
    if (!window.mapboxgl) {
      console.log('[initMapboxGL] Carregando Mapbox GL JS...');
      const script = document.createElement('script');
      script.src = 'https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js';
      script.onload = function() {
        console.log('[initMapboxGL] Mapbox GL JS carregado com sucesso');
        // Configurar o token de acesso
        mapboxgl.accessToken = window.mapboxToken;
        // Disparar evento para notificar que o Mapbox GL está pronto
        document.dispatchEvent(new CustomEvent('mapboxgl:loaded'));
      };
      script.onerror = function() {
        console.error('[initMapboxGL] Erro ao carregar Mapbox GL JS');
      };
      document.head.appendChild(script);
      
      // Adicionar o CSS
      const link = document.createElement('link');
      link.href = 'https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css';
      link.rel = 'stylesheet';
      document.head.appendChild(link);
    } else {
      console.log('[initMapboxGL] Mapbox GL JS já está carregado');
      mapboxgl.accessToken = window.mapboxToken;
      document.dispatchEvent(new CustomEvent('mapboxgl:loaded'));
    }
  };
  
  // Inicializar o Mapbox GL quando a página carregar
  document.addEventListener('DOMContentLoaded', function() {
    window.initMapboxGL();
  });
</script>

    <!-- Scripts principais -->
    <script type="module" src="./main.js"></script>

  </body>
</html>

